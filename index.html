none; font-size: 0.9rem; transition: color var(--animation-speed);">Tutorials</a></li>
                        <li style="margin-bottom: var(--spacing-sm);"><a href="#" style="color: var(--text-dim); text-decoration: none; font-size: 0.9rem; transition: color var(--animation-speed);">Community Forum</a></li>
                    </ul>
                </div>
                <div style="min-width: 150px;">
                    <h3 style="font-size: 1rem; margin-bottom: var(--spacing-md); color: var(--text-light);">Company</h3>
                    <ul style="list-style: none;">
                        <li style="margin-bottom: var(--spacing-sm);"><a href="#" style="color: var(--text-dim); text-decoration: none; font-size: 0.9rem; transition: color var(--animation-speed);">About Us</a></li>
                        <li style="margin-bottom: var(--spacing-sm);"><a href="#" style="color: var(--text-dim); text-decoration: none; font-size: 0.9rem; transition: color var(--animation-speed);">Careers</a></li>
                        <li style="margin-bottom: var(--spacing-sm);"><a href="#" style="color: var(--text-dim); text-decoration: none; font-size: 0.9rem; transition: color var(--animation-speed);">Contact</a></li>
                        <li style="margin-bottom: var(--spacing-sm);"><a href="#" style="color: var(--text-dim); text-decoration: none; font-size: 0.9rem; transition: color var(--animation-speed);">Press Kit</a></li>
                    </ul>
                </div>
                <div style="min-width: 150px;">
                    <h3 style="font-size: 1rem; margin-bottom: var(--spacing-md); color: var(--text-light);">Legal</h3>
                    <ul style="list-style: none;">
                        <li style="margin-bottom: var(--spacing-sm);"><a href="#" style="color: var(--text-dim); text-decoration: none; font-size: 0.9rem; transition: color var(--animation-speed);">Privacy Policy</a></li>
                        <li style="margin-bottom: var(--spacing-sm);"><a href="#" style="color: var(--text-dim); text-decoration: none; font-size: 0.9rem; transition: color var(--animation-speed);">Terms of Service</a></li>
                        <li style="margin-bottom: var(--spacing-sm);"><a href="#" style="color: var(--text-dim); text-decoration: none; font-size: 0.9rem; transition: color var(--animation-speed);">Accessibility</a></li>
                        <li style="margin-bottom: var(--spacing-sm);"><a href="#" style="color: var(--text-dim); text-decoration: none; font-size: 0.9rem; transition: color var(--animation-speed);">Cookie Policy</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div style="max-width: 1400px; margin: var(--spacing-lg) auto 0; padding-top: var(--spacing-md); border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-sm);">
            <p style="color: var(--text-dim); font-size: 0.8rem;">&copy; 2025 Katmai Computing. All rights reserved.</p>
            <div>
                <select id="language-selector" style="background-color: var(--bg-card); border: 1px solid var(--border-color); color: var(--text-dim); padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 0.8rem; cursor: pointer; transition: all var(--animation-speed);">
                    <option value="en">English</option>
                    <option value="fr">Français</option>
                    <option value="de">Deutsch</option>
                    <option value="ja">日本語</option>
                    <option value="zh">中文</option>
                </select>
            </div>
        </div>
    </footer>

    <style>
        /* Enhanced hover effects */
        .class-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .class-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.2);
        }

        /* Improved button interactions */
        .btn-primary:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
        }

        .btn-outline:hover {
            background-color: rgba(139, 92, 246, 0.1);
        }

        /* Enhanced accessibility focus states */
        a:focus-visible,
        button:focus-visible,
        input:focus-visible,
        select:focus-visible {
            outline: 2px solid var(--primary-purple);
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.2);
        }

        /* Smooth link hover effects */
        a {
            transition: color 0.2s ease, transform 0.2s ease;
        }

        a:hover {
            color: var(--primary-purple) !important;
            transform: translateX(2px);
        }

        /* Enhanced form element interactions */
        input[type="search"]:focus,
        select:focus {
            border-color: var(--primary-purple);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        /* Improved badge hover effects */
        .badge {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .badge:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Enhanced loading animations */
        .loader-spinner {
            animation: spin 1s linear infinite, pulse 2s ease-in-out infinite;
        }

        /* Improved mobile responsiveness */
        @media (max-width: 768px) {
            .class-card {
                margin: 0 -1rem;
                border-radius: 0;
            }

            .header-actions {
                gap: 0.5rem;
            }

            .filter-buttons {
                flex-wrap: nowrap;
                overflow-x: auto;
                padding-bottom: 0.5rem;
                margin: 0 -1rem;
                padding: 0 1rem;
            }
        }

        /* Dark mode enhancements */
        @media (prefers-color-scheme: dark) {
            .class-card:hover {
                box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
            }
        }
    </style>

    <script>
        // Main app initialization
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize all modules
            initializeCore();
            initializeTheme();
            initializeAccessibility();
            initializeSearch();
            initializeFavorites();
            initializeComparison();
            initializeCourseActions();
            initializeKeyboardShortcuts();
            
            // Hide loader after everything is initialized
            setTimeout(() => {
                const loader = document.getElementById('app-loader');
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 500);
                
                // Animate cards sequentially
                animateCardsSequentially();
                
                // Show tour guide for new users (if they haven't seen it before)
                if (!localStorage.getItem('tour_completed')) {
                    setTimeout(() => {
                        document.getElementById('tour-guide').style.display = 'block';
                    }, 2000);
                }
                
                // Show course recommendation after a while
                setTimeout(() => {
                    const recommendation = document.getElementById('course-recommendation');
                    recommendation.style.display = 'block';
                    setTimeout(() => {
                        recommendation.style.transform = 'translateY(0)';
                        recommendation.style.opacity = '1';
                    }, 100);
                }, 10000);
            }, 1000);
        });
        
        // Core functionality
        function initializeCore() {
            // Progress bar implementation
            window.addEventListener('scroll', () => {
                try {
                    const winScroll = document.documentElement.scrollTop || document.body.scrollTop;
                    const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                    const scrolled = (winScroll / height) * 100;
                    document.getElementById('progress-bar').style.width = scrolled + '%';
                } catch (error) {
                    console.error('Error updating progress bar:', error);
                }
            });
            
            // Close buttons for various elements
            document.querySelectorAll('[id^="close-"]').forEach(button => {
                button.addEventListener('click', (e) => {
                    try {
                        const target = e.currentTarget.id.replace('close-', '');
                        const element = document.getElementById(target);
                        
                        if (element) {
                            if (target === 'search' || target === 'shortcuts-modal') {
                                element.style.display = 'none';
                            } else if (target === 'favorites-panel') {
                                element.style.transform = 'translateX(100%)';
                            } else if (target === 'compare-panel') {
                                element.style.transform = 'translateY(100%)';
                            } else if (target === 'recommendation') {
                                element.style.opacity = '0';
                                element.style.transform = 'translateY(20px)';
                                setTimeout(() => {
                                    element.style.display = 'none';
                                }, 300);
                            }
                        }
                    } catch (error) {
                        console.error('Error closing element:', error);
                    }
                });
            });
            
            // Topic filters toggle
            document.getElementById('toggle-topics').addEventListener('click', () => {
                try {
                    const topicsFilter = document.getElementById('topics-filter');
                    const button = document.getElementById('toggle-topics');
                    
                    if (topicsFilter.style.display === 'none' || !topicsFilter.style.display) {
                        topicsFilter.style.display = 'block';
                        button.querySelector('span:last-child').textContent = '▲';
                    } else {
                        topicsFilter.style.display = 'none';
                        button.querySelector('span:last-child').textContent = '▼';
                    }
                } catch (error) {
                    console.error('Error toggling topics:', error);
                }
            });
            
            // Handle Search Toggle
            document.getElementById('search-toggle').addEventListener('click', () => {
                try {
                    const searchPanel = document.getElementById('global-search');
                    searchPanel.style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('global-search-input').focus();
                    }, 100);
                } catch (error) {
                    console.error('Error opening search:', error);
                }
            });
            
            // Language selector
            document.getElementById('language-selector').addEventListener('change', (e) => {
                try {
                    const lang = e.target.value;
                    showToast(`Language changed to ${e.target.options[e.target.selectedIndex].text}`, 'info');
                    // In a real app, this would trigger language change
                } catch (error) {
                    console.error('Error changing language:', error);
                }
            });
            
            // Tour guide click
            document.getElementById('tour-guide').addEventListener('click', () => {
                try {
                    startTour();
                    localStorage.setItem('tour_completed', 'true');
                } catch (error) {
                    console.error('Error starting tour:', error);
                }
            });
        }
        
        // Theme functionality
        function initializeTheme() {
            const themeToggle = document.getElementById('theme-toggle');
            
            themeToggle.addEventListener('click', () => {
                try {
                    document.body.classList.toggle('light-mode');
                    
                    // Update icon and store preference
                    if (document.body.classList.contains('light-mode')) {
                        themeToggle.innerHTML = '<span aria-hidden="true">🌞</span>';
                        themeToggle.setAttribute('aria-label', 'Switch to dark mode');
                        localStorage.setItem('theme', 'light');
                    } else {
                        themeToggle.innerHTML = '<span aria-hidden="true">🌓</span>';
                        themeToggle.setAttribute('aria-label', 'Switch to light mode');
                        localStorage.setItem('theme', 'dark');
                    }
                } catch (error) {
                    console.error('Error toggling theme:', error);
                }
            });
            
            // Check for saved theme preference
            try {
                if (localStorage.getItem('theme') === 'light') {
                    document.body.classList.add('light-mode');
                    themeToggle.innerHTML = '<span aria-hidden="true">🌞</span>';
                    themeToggle.setAttribute('aria-label', 'Switch to dark mode');
                }
                // Check for system preference if no saved preference
                else if (window.matchMedia && !localStorage.getItem('theme')) {
                    if (window.matchMedia('(prefers-color-scheme: light)').matches) {
                        document.body.classList.add('light-mode');
                        themeToggle.innerHTML = '<span aria-hidden="true">🌞</span>';
                        themeToggle.setAttribute('aria-label', 'Switch to dark mode');
                    }
                }
            } catch (error) {
                console.error('Error setting initial theme:', error);
            }
        }
        
        // Accessibility functionality
        function initializeAccessibility() {
            try {
                // Accessibility panel toggle
                document.getElementById('a11y-toggle').addEventListener('click', () => {
                    const panel = document.getElementById('a11y-panel');
                    if (panel.style.display === 'none' || !panel.style.display) {
                        panel.style.display = 'block';
                    } else {
                        panel.style.display = 'none';
                    }
                });
                
                // High contrast toggle
                document.getElementById('high-contrast-toggle').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        document.body.classList.add('high-contrast');
                    } else {
                        document.body.classList.remove('high-contrast');
                    }
                    localStorage.setItem('high-contrast', e.target.checked);
                });
                
                // Dyslexic mode toggle
                document.getElementById('dyslexic-toggle').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        document.body.classList.add('dyslexic-mode');
                    } else {
                        document.body.classList.remove('dyslexic-mode');
                    }
                    localStorage.setItem('dyslexic-mode', e.target.checked);
                });
                
                // Reduce motion toggle
                document.getElementById('reduce-motion-toggle').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        document.body.classList.add('reduce-motion');
                    } else {
                        document.body.classList.remove('reduce-motion');
                    }
                    localStorage.setItem('reduce-motion', e.target.checked);
                });
                
                // Font size slider
                document.getElementById('font-size-slider').addEventListener('input', (e) => {
                    document.documentElement.style.fontSize = `${e.target.value}%`;
                    localStorage.setItem('font-size', e.target.value);
                });
                
                // Keyboard shortcuts button
                document.getElementById('a11y-shortcuts-btn').addEventListener('click', () => {
                    const modal = document.getElementById('shortcuts-modal');
                    modal.style.display = 'flex';
                });
                
                // Load saved accessibility preferences
                if (localStorage.getItem('high-contrast') === 'true') {
                    document.getElementById('high-contrast-toggle').checked = true;
                    document.body.classList.add('high-contrast');
                }
                
                if (localStorage.getItem('dyslexic-mode') === 'true') {
                    document.getElementById('dyslexic-toggle').checked = true;
                    document.body.classList.add('dyslexic-mode');
                }
                
                if (localStorage.getItem('reduce-motion') === 'true') {
                    document.getElementById('reduce-motion-toggle').checked = true;
                    document.body.classList.add('reduce-motion');
                }
                
                if (localStorage.getItem('font-size')) {
                    const fontSize = localStorage.getItem('font-size');
                    document.getElementById('font-size-slider').value = fontSize;
                    document.documentElement.style.fontSize = `${fontSize}%`;
                }
            } catch (error) {
                console.error('Error initializing accessibility features:', error);
            }
        }
        
        // Search functionality
        function initializeSearch() {
            try {
                const searchInput = document.querySelector('.search-input');
                const classCards = document.querySelectorAll('.class-card');
                let searchTimeout;
                
                // Global search
                const globalSearchInput = document.getElementById('global-search-input');
                const resultsContainer = document.getElementById('global-search-results');
                
                globalSearchInput.addEventListener('input', debounce(() => {
                    const term = globalSearchInput.value.toLowerCase().trim();
                    
                    if (term.length < 2) {
                        resultsContainer.innerHTML = '<p>Type at least 2 characters to search...</p>';
                        return;
                    }
                    
                    // Simulate search results
                    let results = '';
                    let matchCount = 0;
                    
                    classCards.forEach(card => {
                        const title = card.querySelector('.class-title').textContent;
                        const description = card.querySelector('.class-description').textContent;
                        
                        if (title.toLowerCase().includes(term) || description.toLowerCase().includes(term)) {
                            matchCount++;
                            results += `
                                <div style="padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; gap: 15px; align-items: center;">
                                    <div style="width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(45deg, var(--bg-card), var(--primary-purple)); display: flex; justify-content: center; align-items: center; font-size: 18px; color: white;">
                                        ${card.querySelector('.class-icon').textContent}
                                    </div>
                                    <div style="flex: 1;">
                                        <h3 style="font-size: 16px; margin-bottom: 5px;">${title}</h3>
                                        <p style="font-size: 14px; color: var(--text-dim); margin: 0;">${description.substring(0, 80)}...</p>
                                    </div>
                                    <button class="view-result" data-id="${card.id || 'course-' + Math.random().toString(36).substring(2, 9)}" style="background-color: var(--primary-purple); color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">View</button>
                                </div>
                            `;
                        }
                    });
                    
                    if (matchCount === 0) {
                        results = '<p>No results found. Try different keywords.</p>';
                    } else {
                        results = `<p>Found ${matchCount} results:</p>` + results;
                    }
                    
                    resultsContainer.innerHTML = results;
                    
                    // Add event listeners to result buttons
                    document.querySelectorAll('.view-result').forEach(button => {
                        button.addEventListener('click', () => {
                            document.getElementById('global-search').style.display = 'none';
                            showToast(`Viewing course: ${button.previousElementSibling.querySelector('h3').textContent}`, 'info');
                        });
                    });
                }, 300));
                
                // Local search on the page
                searchInput.addEventListener('input', debounce(() => {
                    const term = searchInput.value.toLowerCase().trim();
                    let visibleCount = 0;
                    
                    classCards.forEach(card => {
                        const title = card.querySelector('.class-title').textContent;
                        const description = card.querySelector('.class-description').textContent;
                        const topics = Array.from(card.querySelectorAll('.badge')).map(badge => badge.textContent);
                        
                        if (
                            term === '' || 
                            title.toLowerCase().includes(term) || 
                            description.toLowerCase().includes(term) || 
                            topics.some(topic => topic.toLowerCase().includes(term))
                        ) {
                            card.style.display = 'flex';
                            visibleCount++;
                        } else {
                            card.style.display = 'none';
                        }
                    });
                    
                    updateNoResultsMessage(visibleCount);
                }, 300));
                
                // Filter buttons
                const filterButtons = document.querySelectorAll('.filter-button');
                let activeFilter = 'all levels';
                
                filterButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        // Remove active class from all buttons
                        filterButtons.forEach(btn => btn.classList.remove('active'));
                        
                        // Add active class to clicked button
                        button.classList.add('active');
                        
                        // Update active filter
                        activeFilter = button.textContent.toLowerCase();
                        
                        // Apply filter
                        applyFilters();
                    });
                });
                
                // Topic checkboxes
                document.querySelectorAll('input[name="topic-filter"]').forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        applyFilters();
                    });
                });
                
                // Sort dropdown
                document.getElementById('sort-options').addEventListener('change', () => {
                    sortCourses();
                });
                
                // Combined filtering function
                function applyFilters() {
                    const term = searchInput.value.toLowerCase().trim();
                    const selectedTopics = Array.from(document.querySelectorAll('input[name="topic-filter"]:checked')).map(cb => cb.value);
                    let visibleCount = 0;
                    
                    classCards.forEach(card => {
                        const level = card.getAttribute('data-level');
                        const title = card.querySelector('.class-title').textContent;
                        const description = card.querySelector('.class-description').textContent;
                        const topics = Array.from(card.querySelectorAll('.badge')).map(badge => badge.textContent.toLowerCase());
                        
                        // Check level filter
                        const levelMatch = activeFilter === 'all levels' || level === activeFilter;
                        
                        // Check search term
                        const searchMatch = 
                            term === '' || 
                            title.toLowerCase().includes(term) || 
                            description.toLowerCase().includes(term) || 
                            topics.some(topic => topic.includes(term));
                        
                        // Check topic filters
                        const topicMatch = selectedTopics.length === 0 || 
                            selectedTopics.some(selectedTopic => {
                                // Map the value to possible badge texts
                                const topicMappings = {
                                    'gates': ['gate', 'cnot', 'toffoli', 'x gate', 'z gate', 'h gate'],
                                    'algorithms': ['algorithm', 'oracle', 'deutsch', 'grover'],
                                    'circuits': ['circuit', 'qubit states', 'bell state'],
                                    'math': ['vector', 'matrices', 'boolean', 'logic'],
                                    'hardware': ['hardware', 'nmr', 'pulse', 'frequency']
                                };
                                
                                const relatedTerms = topicMappings[selectedTopic] || [selectedTopic];
                                return topics.some(topic => 
                                    relatedTerms.some(term => topic.includes(term))
                                );
                            });
                        
                        if (levelMatch && searchMatch && topicMatch) {
                            card.style.display = 'flex';
                            visibleCount++;
                        } else {
                            card.style.display = 'none';
                        }
                    });
                    
                    updateNoResultsMessage(visibleCount);
                    sortCourses(); // Re-apply current sort after filtering
                }
                
                // Update no results message
                function updateNoResultsMessage(visibleCount) {
                    const container = document.querySelector('.classes-grid');
                    let message = container.querySelector('.no-results-message');
                    
                    if (visibleCount === 0) {
                        if (!message) {
                            message = document.createElement('div');
                            message.className = 'no-results-message';
                            message.style.gridColumn = '1 / -1';
                            message.style.padding = '3rem';
                            message.style.textAlign = 'center';
                            message.style.backgroundColor = 'rgba(139, 92, 246, 0.05)';
                            message.style.borderRadius = 'var(--border-radius-md)';
                            message.style.border = '1px dashed var(--border-color)';
                            
                            container.appendChild(message);
                        }
                        
                        message.innerHTML = `
                            <h3 style="margin-bottom: 1rem;">No courses match your criteria</h3>
                            <p style="margin-bottom: 1.5rem; color: var(--text-dim);">Try adjusting your filters or search terms to find what you're looking for.</p>
                            <button id="reset-filters" style="background-color: var(--primary-purple); color: white; border: none; padding: 8px 16px; border-radius: var(--border-radius-sm); cursor: pointer;">Reset Filters</button>
                        `;
                        
                        document.getElementById('reset-filters').addEventListener('click', () => {
                            // Reset search
                            searchInput.value = '';
                            
                            // Reset level filters
                            filterButtons.forEach(btn => btn.classList.remove('active'));
                            document.querySelector('.filter-button:first-child').classList.add('active');
                            activeFilter = 'all levels';
                            
                            // Reset topic filters
                            document.querySelectorAll('input[name="topic-filter"]').forEach(checkbox => {
                                checkbox.checked = false;
                            });
                            
                            // Re-apply filters (which should show all courses now)
                            applyFilters();
                        });
                    } else if (message) {
                        container.removeChild(message);
                    }
                }
                
                // Sort function
                function sortCourses() {
                    const sortOption = document.getElementById('sort-options').value;
                    const container = document.querySelector('.classes-grid');
                    const visibleCards = Array.from(classCards).filter(
                        card => card.style.display !== 'none'
                    );
                    
                    switch (sortOption) {
                        case 'popular':
                            visibleCards.sort((a, b) => {
                                const enrolledA = parseInt(a.querySelector('.class-stat').textContent.match(/\d+/)[0]);
                                const enrolledB = parseInt(b.querySelector('.class-stat').textContent.match(/\d+/)[0]);
                                return enrolledB - enrolledA;
                            });
                            break;
                        case 'newest':
                            // In a real app, this would use actual date data
                            // For demo, just reverse the current order
                            visibleCards.reverse();
                            break;
                        case 'rating':
                            visibleCards.sort((a, b) => {
                                const statsNodes = a.querySelectorAll('.class-stat');
                                const ratingA = parseFloat(statsNodes[statsNodes.length - 1].textContent.match(/[\d.]+/)[0]);
                                
                                const statsBNodes = b.querySelectorAll('.class-stat');
                                const ratingB = parseFloat(statsBNodes[statsBNodes.length - 1].textContent.match(/[\d.]+/)[0]);
                                
                                return ratingB - ratingA;
                            });
                            break;
                        case 'duration':
                            visibleCards.sort((a, b) => {
                                const durationA = parseFloat(a.querySelector('.class-duration').textContent.match(/[\d.]+/)[0]);
                                const durationB = parseFloat(b.querySelector('.class-duration').textContent.match(/[\d.]+/)[0]);
                                return durationA - durationB;
                            });
                            break;
                    }
                    
                    // Re-append cards in the new order
                    visibleCards.forEach(card => {
                        container.appendChild(card);
                    });
                }
            } catch (error) {
                console.error('Error initializing search:', error);
                showToast('There was an error initializing search functionality', 'error');
            }
        }
        
        // Favorites functionality
        function initializeFavorites() {
            try {
                // Favorites toggle
                document.getElementById('favorites-toggle').addEventListener('click', () => {
                    const panel = document.getElementById('favorites-panel');
                    panel.style.display = 'block';
                    setTimeout(() => {
                        panel.style.transform = 'translateX(0)';
                    }, 10);
                    
                    updateFavoritesList();
                });
                
                // Heart buttons on courses
                document.querySelectorAll('.heart-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const card = button.closest('.class-card');
                        const title = card.querySelector('.class-title').textContent;
                        const isFavorite = button.classList.contains('favorited');
                        
                        if (isFavorite) {
                            button.classList.remove('favorited');
                            button.innerHTML = '<span aria-hidden="true" style="color: white; opacity: 0.7; font-size: 16px;">♡</span>';
                            removeFromFavorites(title);
                            showToast(`Removed "${title}" from favorites`, 'info');
                        } else {
                            button.classList.add('favorited');
                            button.innerHTML = '<span aria-hidden="true" style="color: #ff6b6b; opacity: 1; font-size: 16px;">♥</span>';
                            addToFavorites(title, card);
                            showToast(`Added "${title}" to favorites`, 'success');
                        }
                        
                        updateFavoritesCount();
                    });
                });
                
                // Add to favorites function
                function addToFavorites(title, card) {
                    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
                    
                    if (!favorites.some(fav => fav.title === title)) {
                        const level = card.querySelector('.class-level').textContent;
                        const icon = card.querySelector('.class-icon').textContent;
                        
                        favorites.push({
                            title,
                            level,
                            icon
                        });
                        
                        localStorage.setItem('favorites', JSON.stringify(favorites));
                    }
                }
                
                // Remove from favorites function
                function removeFromFavorites(title) {
                    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
                    favorites = favorites.filter(fav => fav.title !== title);
                    localStorage.setItem('favorites', JSON.stringify(favorites));
                }
                
                // Update favorites count
                function updateFavoritesCount() {
                    const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
                    document.getElementById('favorites-count').textContent = favorites.length;
                }
                
                // Update favorites list in panel
                function updateFavoritesList() {
                    const container = document.getElementById('favorites-list');
                    const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
                    
                    if (favorites.length === 0) {
                        container.innerHTML = '<p class="empty-favorites-message" style="text-align: center; padding: 2rem; color: var(--text-dim);">You haven\'t saved any courses yet. Click the heart icon on any course to save it for later.</p>';
                        return;
                    }
                    
                    let html = '';
                    favorites.forEach(fav => {
                        html += `
                            <div style="display: flex; gap: 15px; padding: 15px; border-bottom: 1px solid var(--border-color); align-items: center;">
                                <div style="width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; background: linear-gradient(45deg, var(--bg-darker), var(--primary-purple)); border-radius: 8px; font-size: 18px;">
                                    ${fav.icon}
                                </div>
                                <div style="flex: 1;">
                                    <h3 style="font-size: 14px; margin: 0 0 5px 0;">${fav.title}</h3>
                                    <span style="font-size: 12px; color: var(--text-dim);">${fav.level}</span>
                                </div>
                                <button class="remove-favorite" data-title="${fav.title}" style="background: none; border: none; color: var(--text-dim); cursor: pointer; font-size: 16px;">×</button>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                    
                    // Add event listeners to remove buttons
                    document.querySelectorAll('.remove-favorite').forEach(button => {
                        button.addEventListener('click', () => {
                            const title = button.getAttribute('data-title');
                            removeFromFavorites(title);
                            updateFavoritesList();
                            updateFavoritesCount();
                            
                            // Also update the heart on the card if it's visible
                            document.querySelectorAll('.class-card').forEach(card => {
                                if (card.querySelector('.class-title').textContent === title) {
                                    const heartButton = card.querySelector('.heart-button');
                                    heartButton.classList.remove('favorited');
                                    heartButton.innerHTML = '<span aria-hidden="true" style="color: white; opacity: 0.7; font-size: 16px;">♡</span>';
                                }
                            });
                            
                            showToast(`Removed "${title}" from favorites`, 'info');
                        });
                    });
                }
                
                // Initialize favorites from localStorage
                function initializeSavedFavorites() {
                    const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
                    
                    // Update heart icons on cards
                    document.querySelectorAll('.class-card').forEach(card => {
                        const title = card.querySelector('.class-title').textContent;
                        const heartButton = card.querySelector('.heart-button');
                        
                        if (favorites.some(fav => fav.title === title)) {
                            heartButton.classList.add('favorited');
                            heartButton.innerHTML = '<span aria-hidden="true" style="color: #ff6b6b; opacity: 1; font-size: 16px;">♥</span>';
                        }
                    });
                    
                    updateFavoritesCount();
                }
                
                // Initialize saved favorites
                initializeSavedFavorites();
            } catch (error) {
                console.error('Error initializing favorites:', error);
            }
        }
        
        // Course comparison functionality
        function initializeComparison() {
            try {
                let comparisonOpen = false;
                
                // Comparison toggle
                document.getElementById('compare-toggle').addEventListener('click', () => {
                    const panel = document.getElementById('compare-panel');
                    
                    if (comparisonOpen) {
                        panel.style.transform = 'translateY(100%)';
                        setTimeout(() => {
                            panel.style.display = 'none';
                        }, 300);
                    } else {
                        panel.style.display = 'block';
                        setTimeout(() => {
                            panel.style.transform = 'translateY(0)';
                        }, 10);
                    }
                    
                    comparisonOpen = !comparisonOpen;
                });
                
                // Add course to comparison when clicking "+"
                document.querySelectorAll('.class-card').forEach(card => {
                    // Create a compare button for each card
                    const compareBtn = document.createElement('button');
                    compareBtn.className = 'compare-button';
                    compareBtn.setAttribute('aria-label', 'Add to comparison');
                    compareBtn.innerHTML = '+';
                    compareBtn.style.position = 'absolute';
                    compareBtn.style.top = '10px';
                    compareBtn.style.left = '10px';
                    compareBtn.style.width = '30px';
                    compareBtn.style.height = '30px';
                    compareBtn.style.borderRadius = '50%';
                    compareBtn.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
                    compareBtn.style.color = 'white';
                    compareBtn.style.border = 'none';
                    compareBtn.style.cursor = 'pointer';
                    compareBtn.style.display = 'flex';
                    compareBtn.style.justifyContent = 'center';
                    compareBtn.style.alignItems = 'center';
                    compareBtn.style.zIndex = '2';
                    compareBtn.style.fontSize = '18px';
                    compareBtn.style.opacity = '0';
                    compareBtn.style.transition = 'opacity 0.3s';
                    
                    card.appendChild(compareBtn);
                    
                    // Show compare button on hover
                    card.addEventListener('mouseenter', () => {
                        compareBtn.style.opacity = '1';
                    });
                    
                    card.addEventListener('mouseleave', () => {
                        compareBtn.style.opacity = '0';
                    });
                    
                    // Add to comparison
                    compareBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        addToComparison(card);
                    });
                });
                
                // Add course to comparison function
                function addToComparison(card) {
                    const slots = document.querySelectorAll('.compare-slot.empty');
                    
                    if (slots.length === 0) {
                        showToast('Please remove a course before adding another one', 'info');
                        return;
                    }
                    
                    const title = card.querySelector('.class-title').textContent;
                    const level = card.querySelector('.class-level').textContent;
                    const icon = card.querySelector('.class-icon').textContent;
                    
                    // Check if already in comparison
                    const existingComparisons = document.querySelectorAll('.compare-slot:not(.empty)');
                    for (let i = 0; i < existingComparisons.length; i++) {
                        if (existingComparisons[i].querySelector('h3').textContent === title) {
                            showToast('This course is already in your comparison', 'info');
                            return;
                        }
                    }
                    
                    // Add to first empty slot
                    const slot = slots[0];
                    slot.innerHTML = `
                        <div style="display: flex; gap: 10px; width: 100%; align-items: center;">
                            <div style="width: 30px; height: 30px; display: flex; justify-content: center; align-items: center; background: linear-gradient(45deg, var(--bg-darker), var(--primary-purple)); border-radius: 6px; font-size: 14px;">
                                ${icon}
                            </div>
                            <div style="flex: 1; min-width: 0;">
                                <h3 style="font-size: 12px; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${title}</h3>
                                <span style="font-size: 10px; color: var(--text-dim);">${level}</span>
                            </div>
                            <button class="remove-comparison" data-title="${title}" style="background: none; border: none; color: var(--text-dim); cursor: pointer; font-size: 16px; padding: 0; width: 20px; height: 20px; display: flex; justify-content: center; align-items: center;">×</button>
                        </div>
                    `;
                    slot.classList.remove('empty');
                    
                    // Add click handler for remove button
                    slot.querySelector('.remove-comparison').addEventListener('click', (e) => {
                        e.stopPropagation();
                        const title = e.currentTarget.getAttribute('data-title');
                        slot.innerHTML = '<p>Add a course to compare</p>';
                        slot.classList.add('empty');
                        updateCompareButton();
                    });
                    
                    // Open comparison panel if not open
                    if (!comparisonOpen) {
                        document.getElementById('compare-toggle').click();
                    }
                    
                    // Update compare button state
                    updateCompareButton();
                    
                    showToast(`Added "${title}" to comparison`, 'success');
                }
                
                // Update compare button state
                function updateCompareButton() {
                    const emptySlotsCount = document.querySelectorAll('.compare-slot.empty').length;
                    const filledSlotsCount = 3 - emptySlotsCount;
                    
                    document.getElementById('compare-count').textContent = `(${filledSlotsCount}/3)`;
                    
                    const compareButton = document.getElementById('compare-courses-btn');
                    
                    if (filledSlotsCount >= 2) {
                        compareButton.disabled = false;
                        compareButton.style.opacity = '1';
                        compareButton.style.cursor = 'pointer';
                    } else {
                        compareButton.disabled = true;
                        compareButton.style.opacity = '0.5';
                        compareButton.style.cursor = 'not-allowed';
                    }
                }
                
                // Compare button click
                document.getElementById('compare-courses-btn').addEventListener('click', () => {
                    const titles = Array.from(document.querySelectorAll('.compare-slot:not(.empty) h3')).map(el => el.textContent);
                    showToast(`Comparing courses: ${titles.join(', ')}`, 'info');
                    // In a real app, this would open a detailed comparison view
                });
            } catch (error) {
                console.error('Error initializing comparison:', error);
            }
        }
        
        // Course card actions
        function initializeCourseActions() {
            try {
                // Delegate event handling for efficiency
                document.querySelector('.classes-grid').addEventListener('click', (e) => {
                    const card = e.target.closest('.class-card');
                    if (!card) return;
                    
                    // Preview button click
                    if (e.target.classList.contains('btn-outline')) {
                        e.preventDefault();
                        const previewPanel = card.querySelector('.course-preview');
                        previewPanel.style.display = 'block';
                        return;
                    }
                    
                    // Enroll/Continue button click
                    if (e.target.classList.contains('btn-primary')) {
                        e.preventDefault();
                        const title = card.querySelector('.class-title').textContent;
                        const isEnrolled = e.target.textContent.includes('Review') || e.target.textContent.includes('Continue');
                        
                        if (isEnrolled) {
                            showToast(`Continuing "${title}"`, 'success');
                        } else {
                            showToast(`Enrolled in "${title}"`, 'success');
                            e.target.textContent = 'Continue';
                            e.target.style.backgroundColor = 'var(--success-green)';
                            
                            // Add progress indicator
                            if (!card.querySelector('.progress-display')) {
                                const actionsDiv = card.querySelector('.card-actions');
                                const progressDiv = document.createElement('div');
                                progressDiv.className = 'progress-display';
                                progressDiv.innerHTML = `
                                    <div style="width: 24px; height: 24px; position: relative; display: flex; align-items: center; justify-content: center;">
                                        <svg width="24" height="24" viewBox="0 0 24 24">
                                            <circle cx="12" cy="12" r="10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="2.5"/>
                                            <circle cx="12" cy="12" r="10" fill="none" stroke="var(--primary-purple)" stroke-width="2.5" stroke-dasharray="62.83" stroke-dashoffset="50" transform="rotate(-90 12 12)"/>
                                        </svg>
                                        <span style="position: absolute; font-size: 8px; color: var(--primary-purple);">20%</span>
                                    </div>
                                    <span style="font-size: 0.75rem; color: var(--primary-purple);">In Progress</span>
                                `;
                                
                                progressDiv.style.display = 'flex';
                                progressDiv.style.alignItems = 'center';
                                progressDiv.style.gap = '8px';
                                
                                actionsDiv.prepend(progressDiv);
                            }
                        }
                        return;
                    }
                    
                    // Close preview panel
                    if (e.target.classList.contains('close-preview')) {
                        const previewPanel = e.target.closest('.course-preview');
                        previewPanel.style.display = 'none';
                        return;
                    }
                    
                    // Card body click (not buttons)
                    if (!e.target.closest('button')) {
                        // Toggle preview panel
                        const previewPanel = card.querySelector('.course-preview');
                        if (previewPanel) {
                            if (previewPanel.style.display === 'block') {
                                previewPanel.style.display = 'none';
                            } else {
                                previewPanel.style.display = 'block';
                            }
                        }
                    }
                });
                
                // Add keyboard handling to cards
                document.querySelectorAll('.class-card').forEach((card, index) => {
                    card.addEventListener('keydown', (e) => {
                        const cards = document.querySelectorAll('.class-card');
                        const cardsPerRow = Math.floor(document.querySelector('.classes-grid').clientWidth / card.clientWidth);
                        
                        let nextIndex = index;
                        
                        if (e.key === 'ArrowRight' && index % cardsPerRow < cardsPerRow - 1 && index < cards.length - 1) {
                            nextIndex = index + 1;
                        } else if (e.key === 'ArrowLeft' && index % cardsPerRow > 0) {
                            nextIndex = index - 1;
                        } else if (e.key === 'ArrowDown') {
                            nextIndex = index + cardsPerRow;
                            if (nextIndex >= cards.length) {
                                nextIndex = cards.length - 1;
                            }
                        } else if (e.key === 'ArrowUp') {
                            nextIndex = index - cardsPerRow;
                            if (nextIndex < 0) {
                                nextIndex = index;
                            }
                        } else if (e.key === 'Enter') {
                            const previewBtn = card.querySelector('.btn-outline');
                            if (previewBtn) {
                                previewBtn.click();
                            }
                        } else if (e.key === ' ') {
                            e.preventDefault();
                            const enrollBtn = card.querySelector('.btn-primary');
                            if (enrollBtn) {
                                enrollBtn.click();
                            }
                        } else if (e.key === 'h' || e.key === 'H') {
                            const heartBtn = card.querySelector('.heart-button');
                            if (heartBtn) {
                                heartBtn.click();
                            }
                        } else if (e.key === '+') {
                            const compareBtn = card.querySelector('.compare-button');
                            if (compareBtn) {
                                compareBtn.click();
                            }
                        }
                        
                        if (nextIndex !== index && cards[nextIndex]) {
                            cards[nextIndex].focus();
                        }
                    });
                });
            } catch (error) {
                console.error('Error initializing course actions:', error);
            }
        }
        
        // Keyboard shortcuts
        function initializeKeyboardShortcuts() {
            try {
                document.addEventListener('keydown', (e) => {
                    // Don't trigger shortcuts when typing in input fields
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                        return;
                    }
                    
                    if (e.key === '/' || (e.ctrlKey && e.key === 'k')) {
                        e.preventDefault();
                        document.getElementById('search-toggle').click();
                    } else if (e.key === 'Escape') {
                        // Close any open panels or modals
                        const openElements = [
                            document.getElementById('global-search'),
                            document.getElementById('shortcuts-modal'),
                            document.getElementById('a11y-panel')
                        ];
                        
                        for (const el of openElements) {
                            if (el && (el.style.display === 'block' || el.style.display === 'flex')) {
                                if (el.id === 'global-search' || el.id === 'shortcuts-modal') {
                                    el.style.display = 'none';
                                } else {
                                    el.style.display = 'none';
                                }
                                return;
                            }
                        }
                        
                        const panelElements = [
                            document.getElementById('favorites-panel'),
                            document.getElementById('compare-panel')
                        ];
                        
                        for (const el of panelElements) {
                            if (el && getComputedStyle(el).transform !== 'matrix(1, 0, 0, 1, 0, 0)' && el.style.display !== 'none') {
                                if (el.id === 'favorites-panel') {
                                    el.style.transform = 'translateX(100%)';
                                } else if (el.id === 'compare-panel') {
                                    el.style.transform = 'translateY(100%)';
                                }
                                return;
                            }
                        }
                    } else if (e.key === 'f' || e.key === 'F') {
                        document.getElementById('favorites-toggle').click();
                    } else if (e.key === 't' || e.key === 'T') {
                        document.getElementById('theme-toggle').click();
                    } else if (e.key === 'a' || e.key === 'A') {
                        document.getElementById('a11y-toggle').click();
                    } else if (e.key === 'c' || e.key === 'C') {
                        document.getElementById('compare-toggle').click();
                    } else if (e.key === '?') {
                        document.getElementById('shortcuts-modal').style.display = 'flex';
                    }
                });
            } catch (error) {
                console.error('Error initializing keyboard shortcuts:', error);
            }
        }
        
        // Helper functions
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }
        
        function showToast(message, type = 'info') {
            try {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                
                // Set toast style based on type
                const backgroundColor = 
                    type === 'success' ? 'rgba(16, 185, 129, 0.9)' : 
                    type === 'error' ? 'rgba(239, 68, 68, 0.9)' : 
                    'rgba(59, 130, 246, 0.9)';
                
                // Create the toast element
                toast.style.backgroundColor = backgroundColor;
                toast.style.color = 'white';
                toast.style.padding = '12px 16px';
                toast.style.borderRadius = '4px';
                toast.style.marginBottom = '10px';
                toast.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
                toast.style.display = 'flex';
                toast.style.alignItems = 'center';
                toast.style.justifyContent = 'space-between';
                toast.style.minWidth = '300px';
                toast.style.maxWidth = '400px';
                toast.style.animation = 'slideIn 0.3s forwards';
                
                toast.innerHTML = `
                    <div>${message}</div>
                    <button style="background: none; border: none; color: white; font-size: 16px; cursor: pointer; margin-left: 10px;">×</button>
                `;
                
                // Add close functionality
                toast.querySelector('button').addEventListener('click', () => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateX(100%)';
                    setTimeout(() => container.removeChild(toast), 300);
                });
                
                // Add to container
                container.appendChild(toast);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (toast.parentNode === container) {
                        toast.style.opacity = '0';
                        toast.style.transform = 'translateX(100%)';
                        setTimeout(() => {
                            if (toast.parentNode === container) {
                                container.removeChild(toast);
                            }
                        }, 300);
                    }
                }, 5000);
            } catch (error) {
                console.error('Error showing toast:', error);
            }
        }
        
        function animateCardsSequentially() {
            try {
                const cards = document.querySelectorAll('.class-card');
                cards.forEach((card, index) => {
                    setTimeout(() => {
                        card.classList.add('loaded');
                    }, 100 * index);
                });
            } catch (error) {
                console.error('Error animating cards:', error);
            }
        }
        
        function startTour() {
            try {
                // Simple guided tour implementation
                const tourSteps = [
                    { 
                        element: '.header-actions', 
                        message: 'Use these buttons to search, view saved courses, or change the theme' 
                    },
                    { 
                        element: '.learning-path',
                        message: 'This learning path shows the recommended sequence of courses'
                    },
                    {
                        element: '.search-filter',
                        message: 'Use these filters to find exactly what you\'re looking for'
                    },
                    {
                        element: '.class-card',
                        message: 'Click on any course to preview its contents and enroll'
                    },
                    {
                        element: '.heart-button',
                        message: 'Save your favorite courses for later by clicking the heart icon'
                    },
                    {
                        element: '#a11y-toggle',
                        message: 'Access accessibility options any time from this button'
                    }
                ];
                
                let currentStep = 0;
                
                function showTourStep() {
                    if (currentStep >= tourSteps.length) {
                        showToast('Tour completed! Explore Katmai Computing at your own pace.', 'success');
                        return;
                    }
                    
                    const step = tourSteps[currentStep];
                    const element = document.querySelector(step.element);
                    
                    if (!element) {
                        currentStep++;
                        showTourStep();
                        return;
                    }
                    
                    // Create tooltip
                    const tooltip = document.createElement('div');
                    tooltip.className = 'tour-tooltip';
                    tooltip.style.position = 'absolute';
                    tooltip.style.backgroundColor = 'var(--primary-purple)';
                    tooltip.style.color = 'white';
                    tooltip.style.padding = '15px';
                    tooltip.style.borderRadius = '8px';
                    tooltip.style.boxShadow = '0 5px 15px rgba(0,0,0,0.3)';
                    tooltip.style.zIndex = '1000';
                    tooltip.style.maxWidth = '300px';
                    tooltip.style.animation = 'fadeIn 0.3s';
                    
                    tooltip.innerHTML = `
                        <div style="margin-bottom: 10px;">
                            <strong>Step ${currentStep + 1}/${tourSteps.length}</strong>
                        </div>
                        <p style="margin: 0 0 10px 0;">${step.message}</p>
                        <div style="display: flex; justify-content: space-between;">
                            <button id="tour-back" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer;" ${currentStep === 0 ? 'disabled' : ''}>Back</button>
                            <button id="tour-next" style="background: white; border: none; color: var(--primary-purple); padding: 5px 10px; border-radius: 4px; cursor: pointer;">${currentStep === tourSteps.length - 1 ? 'Finish' : 'Next'}</button>
                        </div>
                    `;
                    
                    document.body.appendChild(tooltip);
                    
                    // Position tooltip next to element
                    const rect = element.getBoundingClientRect();
                    const tooltipRect = tooltip.getBoundingClientRect();
                    
                    let top = rect.top + window.scrollY + rect.height / 2 - tooltipRect.height / 2;
                    let left = rect.right + window.scrollX + 20;
                    
                    // Make sure tooltip is visible in viewport
                    if (left + tooltipRect.width > window.innerWidth) {
                        left = rect.left - tooltipRect.width - 20;
                    }
                    
                    if (top < window.scrollY) {
                        top = window.scrollY + 20;
                    }
                    
                    if (top + tooltipRect.height > window.scrollY + window.innerHeight) {
                        top = window.scrollY + window.innerHeight - tooltipRect.height - 20;
                    }
                    
                    tooltip.style.top = `${top}px`;
                    tooltip.style.left = `${left}px`;
                    
                    // Highlight current element
                    element.style.position = 'relative';
                    element.style.zIndex = '999';
                    element.style.boxShadow = '0 0 0 4px var(--primary-purple)';
                    element.style.transition = 'box-shadow 0.3s';
                    
                    // Add event listeners to buttons
                    document.getElementById('tour-next').addEventListener('click', () => {
                        element.style.boxShadow = 'none';
                        document.body.removeChild(tooltip);
                        currentStep++;
                        showTourStep();
                    });
                    
                    if (currentStep > 0) {
                        document.getElementById('tour-back').addEventListener('click', () => {
                            element.style.boxShadow = 'none';
                            document.body.removeChild(tooltip);
                            currentStep--;
                            showTourStep();
                        });
                    }
                    
                    // Scroll element into view if needed
                    if (rect.top < 0 || rect.bottom > window.innerHeight) {
                        element.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }
                }
                
                showTourStep();
            } catch (error) {
                console.error('Error starting tour:', error);
                showToast('There was an error starting the tour', 'error');
            }
        }

        // Add smooth scrolling to all links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Enhance keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                document.body.classList.add('keyboard-nav');
            }
        });

        document.addEventListener('mousedown', function() {
            document.body.classList.remove('keyboard-nav');
        });
    </script>
</body>
</html>
